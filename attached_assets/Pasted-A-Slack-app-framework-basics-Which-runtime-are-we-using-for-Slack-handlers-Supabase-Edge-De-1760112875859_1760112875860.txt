A) Slack app + framework basics

Which runtime are we using for Slack handlers?

â˜ Supabase Edge (Deno, plain HTTP)

â˜ Bolt for JS (Node/Express)

â˜ Other (describe)

Current Slack endpoints (from KB I see /slack/command, /slack/oauth, /slack/events). Confirm exact paths used in Test:

slash command URL:

views.open/submit webhook handler path (same as command, or separate?):

events URL (for app_uninstalled):

Scopes and interactivity:

Confirm scopes: commands, chat:write (any others?)

Interactivity + modal handling enabled in Slack App config: â˜ Yes / â˜ No

Modal stack strategy:

Prefer submit â†’ response_action: "push" for the review modal (best UX): â˜ Yes / â˜ No

If â€œNo,â€ do you prefer views.push from a â€œReviewâ€ button? (requires fresh trigger_id) â˜ Yes / â˜ No

B) Data model / org binding

How do we resolve org_id from a Slack team during modal submits? (e.g., read by team.id â†’ slack_teams â†’ org_id)

Where do we store per-org settings used in the review screen?

orgs.settings.k_anonymity.threshold (k): â˜ Yes key / â˜ Noâ€”where should I read it?

digest channel / topic mapping source of truth: â˜ slack_settings / â˜ topics / â˜ other

Topic selection in the Input modal:

Do we currently expose a Topic dropdown to the user? â˜ Yes / â˜ No

If â€œNo,â€ whatâ€™s the default topic? (or do we always send to a single channel?)

C) Input model (SBI + ancillary fields)

Finalize SBI fields in Modal A:

Situation (multiline)

Behavior (multiline)

Impact (multiline)

Any optional fields to include now? (e.g., Topic select, private â€œfor moderators onlyâ€ flag, severity, attachments link)

Field limits in Slack:

Max chars per field you want enforced? (Slack plain_text_input hard-limit vs. our soft validation)

Validation rules to enforce before the Review step (examples):

Minimum combined length?

Block if all three are empty (obvious): â˜ Yes

Disallow messages that are only links/numbers? â˜ Yes / â˜ No

D) Scrub â†’ Rewrite â†’ Eligibility (what the Review modal must show)

Scrub implementation (server-side production):

Do we already have the robust scrubber from the simulator v2 (emails, Slack mentions <@Uâ€¦>, <#Câ€¦>, subteams, obfuscated emails, phones, IDs, URLs, IPv4, Luhn)?
â˜ Yes (path:) â˜ No (Iâ€™ll port the JS regex set you approved)

Should we highlight redactions in the review modal (e.g., wrap with backticks or brackets), or show a simple diff? Preference:

Rewrite logic (what leaders might see in digests):

Do we have a quote-prep function today (trim specifics, normalize dates/names, enforce max length)?
â˜ Yes (path:) â˜ No (Iâ€™ll implement: trim to N chars, drop exact dates/IDs, keep gist)

Max length for a single quote line in digest? (e.g., 240 chars)

k-anonymity message in the Review modal:

What value of k do we show? From orgs.settings.k_anonymity.threshold or a global default (e.g., 5)?

Should we surface current signals in selected theme/topic (if known) or just the rule (â€œQuotes appear only when â‰¥ kâ€)?

If signals are available, where do I fetch them quickly without heavy compute?

Eligibility states to display:

Always show: â€œWonâ€™t be released unless k-threshold is met.â€

If signals >= k at submit time, should we explicitly state â€œEligible to appear as a quote (scrubbed)â€?

Any legal wording we must include?

E) UX specifics for the second modal

Before â†’ After blocks:

Show user text exactly as typed (concatenated SBI)? â˜ Yes

Show scrubbed version with visible placeholders [email], [@redacted], etc.? â˜ Yes

Show â€œWhat leaders might seeâ€ = rewritten & scrubbed? â˜ Yes

Buttons:

Primary: Send

Secondary: Go back (returns to Modal A with fields preserved)

Tertiary: Cancel (close modal) â˜ Include / â˜ Omit

Add Block Kit confirm on Send? (â€œAre you sure? This will be posted anonymously.â€) â˜ Yes / â˜ No

Navigation:

For Go back, Iâ€™ll use response_action: "update" and re-render Modal A with fields restored via private_metadata. OK? â˜ Yes

Copy tone (final review screen):

Short, reassuring; bullets ok? Provide any â€œmust-useâ€ phrases or legal disclaimers you want locked.

F) Posting destination & threading

Where does the final post go?

Channel: from orgâ€™s Slack settings? â˜ Yes

Topic â†’ channel mapping? (If Topic selected, map it to a channel; confirm table/source)

Post as:

â˜ A new parent â€œthreadâ€ message (anonymous post)

â˜ An ephemeral confirmation only (no channel post)? (for certain topics?)

Do we also DM the submitter a receipt (ephemeral) summarizing what was sent? â˜ Yes / â˜ No

Message format in channel:

Do we include a small header like â€œNew anonymous feedback (Topic: X)â€ and the rewritten text?

Add a reaction set (e.g., ğŸ‘€ âœ… âŒ) automatically? â˜ Yes / â˜ No

G) Security, logging, performance

3-second rule: Our submit handler must scrub/prepare and return response_action: "push" under 3s. Any heavy steps I should defer (e.g., theme scoring) to background after Send?

Logging: Confirm we NEVER log plaintext fields (S/B/I) at any step, including validation errors.

Rate limiting: Any per-user or per-team limits for /teammato today? If not, should I add a simple guard (e.g., 1 submit/5s per user_id)?

Moderation flags: Should we run a fast rule-based check and add a hidden â€œflagâ€ badge in the review (e.g., profanity/PII density), or keep this invisible to the user for now?

H) Internationalization & accessibility

Any locales beyond English we must support in the modal copy?

Accessibility: prefer shorter labels + hint text. Any internal terminology we must avoid?

I) Storage & metadata handoff

Where should I store the pre-scrub text vs post-scrub?

As per KB, bodies in DB are encrypted; confirm that the stored payload is the scrubbed version (not raw), and identity is never stored.

private_metadata payload shape between views:

OK to JSON-encode { org_id, team_id, user_id (for DM only), topic_id, k, fields: { situation, behavior, impact }, scrubbed, rewritten }? â˜ Yes

Any size constraints I should worry about? (Slack allows ~3â€“4KB; our SBI should fit.)

J) Test vs live, and QA plan

Weâ€™ll ship to Test app first. Confirm Test app credentials set in Supabase Edge secrets and interactivity URL matches our handler.

Sandbox test plan:

Iâ€™ll include sample payloads using views.open and view_submission with Slackâ€™s example triggers. OK to add a /teammato review dev-only shortcut? â˜ Yes

Success criteria you want validated before Live flip:

(a) Two-step flow works under 3s; (b) No plaintext in logs; (c) Correct channel/topic; (d) k-message shown; (e) Cancel/Back behaves; (f) Uninstall event still redacts & disables digests.

K) Edge cases to lock down

Empty or near-empty input (e.g., only whitespace or only a URL) â†’ block with inline error on Modal A? â˜ Yes

Extremely long input (>5k chars across SBI) â†’ truncate with polite error? Desired max length: ____

Inputs packed with PII (emails/phones/IDs) â†’ allow but scrub and show strong warning on Review? â˜ Yes / â˜ No

Small teams (k high, signals low) â†’ always show â€œWill not be released until â‰¥ k.â€ Any alternate wording?