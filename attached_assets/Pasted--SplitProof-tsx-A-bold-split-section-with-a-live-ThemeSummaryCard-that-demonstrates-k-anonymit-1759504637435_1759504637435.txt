// SplitProof.tsx
// A bold split section with a live ThemeSummaryCard that demonstrates k-anonymity.
// No external deps. Drop under the Steps section.

import { useState } from "react";
import { ShieldCheck, Lock, EyeOff, CheckCircle2 } from "lucide-react";

type Theme = { id: number; label: string; count: number };

const THEMES: Theme[] = [
  { id: 1, label: "Workload & scope creep", count: 12 },
  { id: 2, label: "Decision clarity", count: 9 },
  { id: 3, label: "Release coordination", count: 7 },
  { id: 4, label: "On-call burnout", count: 2 }, // small-n example
];

export default function SplitProof() {
  const [k, setK] = useState<number>(5);
  const [enforceK, setEnforceK] = useState<boolean>(true);

  const visible = (t: Theme) => !enforceK || t.count >= k;

  return (
    <section className="relative isolate">
      {/* soft background shape */}
      <div className="pointer-events-none absolute inset-0 -z-10 bg-gradient-to-b from-emerald-50/40 to-transparent" />

      <div className="mx-auto grid max-w-6xl grid-cols-1 items-center gap-12 px-6 py-24 lg:grid-cols-2 lg:py-28">
        {/* LEFT: copy */}
        <div>
          <p className="font-mono text-sm uppercase tracking-wide text-muted-foreground">
            Why it’s safe
          </p>
          <h2 className="mt-2 text-3xl font-semibold tracking-tight md:text-4xl">
            We show <span className="underline decoration-emerald-400">themes</span>, not people.
          </h2>
          <p className="mt-4 max-w-prose text-lg text-muted-foreground">
            Posts are stored as ciphertext and summarized into k-anonymous themes. Views and exports
            suppress any topic with fewer than <span className="font-mono">k</span> posts—so nobody can “read between the lines.”
          </p>

          <ul className="mt-6 space-y-3 text-base">
            <li className="flex items-start gap-3">
              <ShieldCheck className="mt-0.5 h-5 w-5 text-emerald-600" />
              <span><strong>k-anonymous by default</strong> — small-n topics stay hidden.</span>
            </li>
            <li className="flex items-start gap-3">
              <Lock className="mt-0.5 h-5 w-5 text-emerald-600" />
              <span><strong>Ciphertext storage</strong> — plaintext is never stored.</span>
            </li>
            <li className="flex items-start gap-3">
              <EyeOff className="mt-0.5 h-5 w-5 text-emerald-600" />
              <span><strong>No PII in logs</strong> — scrubbed at ingestion.</span>
            </li>
          </ul>

          {/* controls */}
          <div className="mt-8 flex flex-wrap items-center gap-4">
            <label className="inline-flex items-center gap-2">
              <input
                type="checkbox"
                className="size-4 accent-emerald-600"
                checked={enforceK}
                onChange={() => setEnforceK((v) => !v)}
              />
              <span className="text-sm">Enforce k-anonymity</span>
            </label>

            <div className="flex items-center gap-3 rounded-xl border bg-background px-3 py-2">
              <span className="text-sm text-muted-foreground">k threshold</span>
              <div className="flex items-center gap-2">
                <button
                  onClick={() => setK((n) => Math.max(2, n - 1))}
                  className="rounded-lg border px-2 py-1 text-sm hover:bg-muted"
                >
                  −
                </button>
                <span className="w-6 text-center font-mono">{k}</span>
                <button
                  onClick={() => setK((n) => Math.min(12, n + 1))}
                  className="rounded-lg border px-2 py-1 text-sm hover:bg-muted"
                >
                  +
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* RIGHT: ThemeSummaryCard */}
        <div className="relative">
          <div className="rounded-3xl border bg-background p-6 shadow-[0_1px_0_rgba(0,0,0,0.06),0_28px_60px_-28px_rgba(0,0,0,0.25)]">
            <header className="flex items-center justify-between">
              <div>
                <h3 className="text-xl font-medium">Weekly digest</h3>
                <p className="text-sm text-muted-foreground">Top themes for #team-general</p>
              </div>
              <span className="inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-700 ring-1 ring-emerald-200">
                <CheckCircle2 className="h-4 w-4" /> Meets k-threshold
              </span>
            </header>

            <div className="mt-5 grid gap-3">
              {THEMES.map((t) => (
                <div
                  key={t.id}
                  className={`group rounded-2xl border p-4 transition-colors ${
                    visible(t) ? "bg-white" : "bg-muted"
                  }`}
                >
                  <div className="flex items-center justify-between">
                    <div className="text-base font-medium">
                      {visible(t) ? t.label : "Hidden until it meets k"}
                    </div>
                    <div className="inline-flex items-center gap-2">
                      <span
                        className={`rounded-full px-2.5 py-1 text-xs ${
                          visible(t)
                            ? "bg-emerald-50 text-emerald-700 ring-1 ring-emerald-200"
                            : "bg-neutral-200 text-neutral-700"
                        }`}
                      >
                        {visible(t) ? `${t.count} posts` : `needs ≥ ${k}`}
                      </span>
                    </div>
                  </div>

                  {/* hint row */}
                  <div className="mt-2 text-xs text-muted-foreground">
                    {visible(t)
                      ? "Included in analytics and exports."
                      : "Suppressed from views and exports to protect contributors."}
                  </div>
                </div>
              ))}
            </div>

            <footer className="mt-5 text-xs text-muted-foreground">
              Exported data respects the same threshold.
            </footer>
          </div>

          {/* decorative glow */}
          <div className="pointer-events-none absolute -inset-6 -z-10 rounded-[2rem] bg-gradient-to-tr from-emerald-200/30 via-transparent to-transparent blur-2xl" />
        </div>
      </div>
    </section>
  );
}
